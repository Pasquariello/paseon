{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _Date$now from \"@babel/runtime-corejs2/core-js/date/now\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nvar _jsxFileName = \"/Users/taylorpasquariello/learning_resources/paseon/paseon/utils/auth.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useEffect } from 'react';\nimport Router from 'next/router';\nimport nextCookie from 'next-cookies';\nimport cookie from 'js-cookie';\nimport { compose } from 'redux'; // import { login_action } from '../redux/actions/auth'\n\nimport { useDispatch } from 'react-redux';\nimport getUrl from './getUrl';\nexport var login = function login(_ref) {\n  var token = _ref.token;\n  cookie.set('token', token, {\n    expires: 36000\n  });\n  Router.push('/dashboard');\n};\nexport var getUserData = function getUserData(ctx) {\n  var _nextCookie, userId, url, response;\n\n  return _regeneratorRuntime.async(function getUserData$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _nextCookie = nextCookie(ctx), userId = _nextCookie.userId;\n          url = \"\".concat(getUrl, \"/account/get_acct_details\");\n          _context2.prev = 2;\n          _context2.next = 5;\n          return _regeneratorRuntime.awrap(fetch(url, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: _JSON$stringify({\n              id: userId\n            })\n          }).then(function _callee(response) {\n            var error;\n            return _regeneratorRuntime.async(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    if (!(response.status !== 200)) {\n                      _context.next = 4;\n                      break;\n                    }\n\n                    error = new Error(response.statusText);\n                    error.response = response;\n                    throw error;\n\n                  case 4:\n                    _context.next = 6;\n                    return _regeneratorRuntime.awrap(response.json().then(function (data) {\n                      var dispatch = ctx.reduxStore.dispatch;\n                      dispatch({\n                        type: 'USER_LOADED',\n                        payload: data\n                      });\n                    }));\n\n                  case 6:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            });\n          }));\n\n        case 5:\n          _context2.next = 11;\n          break;\n\n        case 7:\n          _context2.prev = 7;\n          _context2.t0 = _context2[\"catch\"](2);\n          console.error('You have an error in your code or there are Network issues.', _context2.t0);\n          response = _context2.t0.response;\n\n        case 11:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, [[2, 7]]);\n};\nexport var auth = function auth(ctx) {\n  var _nextCookie2, token, userId;\n\n  return _regeneratorRuntime.async(function auth$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _nextCookie2 = nextCookie(ctx), token = _nextCookie2.token, userId = _nextCookie2.userId;\n          /*\n           * If `ctx.req` is available it means we are on the server.\n           * Additionally if there's no token it means the user is not logged in.\n           */\n\n          if (ctx.req && !token) {\n            ctx.res.writeHead(302, {\n              Location: '/login'\n            });\n            ctx.res.end();\n          } // We already checked for server. This should only happen on client.\n\n\n          if (!token) {\n            Router.push('/login');\n          }\n\n          return _context3.abrupt(\"return\", userId);\n\n        case 4:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  });\n};\nexport var logout = function logout() {\n  cookie.remove('token'); // to support logging out from all windows\n\n  window.localStorage.setItem('logout', _Date$now());\n  Router.push('/login');\n};\nexport var withAuthSync = function withAuthSync(WrappedComponent) {\n  var Wrapper = function Wrapper(props) {\n    var syncLogout = function syncLogout(event) {\n      if (event.key === 'logout') {\n        console.log('logged out from storage!');\n        Router.push('/login');\n      }\n    };\n\n    useEffect(function () {\n      window.addEventListener('storage', syncLogout);\n      return function () {\n        window.removeEventListener('storage', syncLogout);\n        window.localStorage.removeItem('logout');\n      };\n    }, [null]);\n    return __jsx(WrappedComponent, _extends({}, props, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    }));\n  };\n\n  Wrapper.getInitialProps = function _callee2(ctx) {\n    var token, componentProps;\n    return _regeneratorRuntime.async(function _callee2$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            token = auth(ctx);\n            _context4.t0 = WrappedComponent.getInitialProps;\n\n            if (!_context4.t0) {\n              _context4.next = 6;\n              break;\n            }\n\n            _context4.next = 5;\n            return _regeneratorRuntime.awrap(WrappedComponent.getInitialProps(ctx));\n\n          case 5:\n            _context4.t0 = _context4.sent;\n\n          case 6:\n            componentProps = _context4.t0;\n            return _context4.abrupt(\"return\", _objectSpread({}, componentProps, {\n              token: token\n            }));\n\n          case 8:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    });\n  };\n\n  return Wrapper;\n};","map":{"version":3,"sources":["/Users/taylorpasquariello/learning_resources/paseon/paseon/utils/auth.js"],"names":["useEffect","Router","nextCookie","cookie","compose","useDispatch","getUrl","login","token","set","expires","push","getUserData","ctx","userId","url","fetch","method","headers","body","id","then","response","status","error","Error","statusText","json","data","dispatch","reduxStore","type","payload","console","auth","req","res","writeHead","Location","end","logout","remove","window","localStorage","setItem","withAuthSync","WrappedComponent","Wrapper","props","syncLogout","event","key","log","addEventListener","removeEventListener","removeItem","getInitialProps","componentProps"],"mappings":"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","sourcesContent":["import { useEffect } from 'react'\nimport Router from 'next/router'\nimport nextCookie from 'next-cookies'\nimport cookie from 'js-cookie'\nimport { compose } from 'redux'\n// import { login_action } from '../redux/actions/auth'\nimport { useDispatch } from 'react-redux'\nimport getUrl from './getUrl';\n\n\nexport const login = ({ token }) => {\n\n  cookie.set('token', token, { expires: 36000 })\n\n  Router.push('/dashboard')\n}\n\n\nexport const getUserData  = async (ctx) =>  {\n\n  const { userId } = nextCookie(ctx)\n  let url = `${getUrl}/account/get_acct_details`\n  \n  try {\n\n    await fetch(url, {\n      \n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({id: userId})\n      \n    }).then(\n      async function(response) {\n        if (response.status !== 200) {\n            let error = new Error(response.statusText)\n            error.response = response\n            throw error\n        }\n\n        await response.json().then(function(data){\n          const { dispatch } = ctx.reduxStore;\n\n          dispatch({\n            type: 'USER_LOADED',\n            payload: data\n          });\n        })\n      }\n    )\n    \n  } catch (error) {\n    console.error('You have an error in your code or there are Network issues.',error)\n\n    const { response } = error\n   \n  }\n}\n\n\n\n\n\nexport const auth = async ctx => {\n  const { token, userId } = nextCookie(ctx)\n  /*\n   * If `ctx.req` is available it means we are on the server.\n   * Additionally if there's no token it means the user is not logged in.\n   */\n  if (ctx.req && !token) {\n    ctx.res.writeHead(302, { Location: '/login' })\n    ctx.res.end()\n  }\n\n  // We already checked for server. This should only happen on client.\n  if (!token) {\n    Router.push('/login')\n  }\n\n  return userId;\n}\n\nexport const logout = () => {\n  cookie.remove('token')\n  // to support logging out from all windows\n  window.localStorage.setItem('logout', Date.now())\n  Router.push('/login')\n}\n\nexport const withAuthSync = WrappedComponent => {\n  const Wrapper = props => {\n    const syncLogout = event => {\n      if (event.key === 'logout') {\n        console.log('logged out from storage!')\n        Router.push('/login')\n      }\n    }\n\n    useEffect(() => {\n      window.addEventListener('storage', syncLogout)\n\n      return () => {\n        window.removeEventListener('storage', syncLogout)\n        window.localStorage.removeItem('logout')\n      }\n    }, [null])\n\n    return <WrappedComponent {...props} />\n  }\n\n  Wrapper.getInitialProps = async ctx => {\n    const token = auth(ctx)\n\n    const componentProps =\n      WrappedComponent.getInitialProps &&\n      (await WrappedComponent.getInitialProps(ctx))\n\n    return { ...componentProps, token }\n  }\n\n  return Wrapper\n}"]},"metadata":{},"sourceType":"module"}